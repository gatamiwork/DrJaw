<UserControl x:Class="DrJaw.Views.User.UserPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:beh="clr-namespace:DrJaw.Behaviors">
    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- 1: панель фильтров/действий -->
            <RowDefinition Height="*"/>
            <!-- 2: таблица -->
            <RowDefinition Height="Auto"/>
            <!-- 3: панель кнопок -->
            <RowDefinition Height="Auto"/>
            <!-- 4: итоги -->
        </Grid.RowDefinitions>

        <Grid Margin="0,0,0,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="180"/>
                <ColumnDefinition Width="12"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="160"/>
                <ColumnDefinition Width="12"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="220"/>
                <!-- SearchBox -->
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <!-- Обновить -->
            </Grid.ColumnDefinitions>

            <!-- Mart -->
            <TextBlock Grid.Column="0" Text="Точка:" VerticalAlignment="Center" Margin="0,0,8,0"/>
            <ComboBox  Grid.Column="1"
             ItemsSource="{Binding Marts}"
             SelectedItem="{Binding Mart, Mode=TwoWay}"
             DisplayMemberPath="Name"
             MinWidth="160"/>

            <!-- Metal -->
            <TextBlock Grid.Column="3" Text="Металл:" VerticalAlignment="Center" Margin="0,0,8,0"/>
            <ComboBox  Grid.Column="4"
             ItemsSource="{Binding Metals}"
             SelectedItem="{Binding Metal, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
             DisplayMemberPath="Name"
             MinWidth="140"/>

            <!-- Поиск (пока без логики) -->
            <TextBlock Grid.Column="6" Text="Поиск:" VerticalAlignment="Center" Margin="0,0,8,0"/>
            <TextBox   Grid.Column="7" x:Name="SearchBox" MinWidth="200" materialDesign:TextFieldAssist.HasClearButton="True" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"/>
            <!-- Обновить -->
            <Button Grid.Column="9"
              Content="Обновить"
              MinWidth="110"
              Command="{Binding UpdateCommand}"/>
        </Grid>

        <!-- 2) Грид: DataGrid MSSQLItems -->
        <DataGrid Grid.Row="1"
          beh:DataGridTriStateSort.Enable="True"
          FrozenColumnCount="1"
          ItemsSource="{Binding MSSQLItems}"
          SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
          AutoGenerateColumns="False"
          IsReadOnly="True"
          CanUserAddRows="False"
          CanUserDeleteRows="False"
          CanUserReorderColumns="False"
          CanUserResizeRows="False"
          SelectionUnit="FullRow"
          SelectionMode="Single"
          HeadersVisibility="Column"
          Margin="0,0,0,8"
          EnableRowVirtualization="True"
          EnableColumnVirtualization="True"
          VirtualizingPanel.IsVirtualizing="True"
          VirtualizingPanel.VirtualizationMode="Recycling"
          VirtualizingPanel.ScrollUnit="Pixel">
            <DataGrid.InputBindings>
                <MouseBinding Gesture="LeftDoubleClick"
                      Command="{Binding OpenImageCommand}"
                      CommandParameter="{Binding SelectedItem, RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
            </DataGrid.InputBindings>
            <DataGrid.Columns>
                <DataGridTemplateColumn Header="✓" Width="auto" IsReadOnly="True" CanUserSort="False">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn Header="Тип"           Binding="{Binding Type}"         MinWidth="150"/>
                <DataGridTextColumn Header="Металл"        Binding="{Binding Metal}"        MinWidth="120"/>
                <DataGridTextColumn Header="Артикул"       Binding="{Binding Articul}"      MinWidth="200"/>
                <DataGridTextColumn Header="Вес"           Binding="{Binding Weight, StringFormat=N3}" MinWidth="90"/>
                <DataGridTextColumn Header="Кол-во"        Binding="{Binding ItemCount}"    MinWidth="80"/>
                <DataGridTextColumn Header="Размер"        Binding="{Binding Size}"         MinWidth="90"/>
                <DataGridTextColumn Header="Вставки"       Binding="{Binding Stones}"       MinWidth="140"/>
                <DataGridTextColumn Header="Комментарий"   Binding="{Binding Comment}"      MinWidth="140"/>
                <DataGridTextColumn Header="Цена"          Binding="{Binding Price, StringFormat=N2}"  MinWidth="110"/>
                <DataGridTextColumn Header="Производитель" Binding="{Binding Manufacturer}" MinWidth="150"/>
                <DataGridTextColumn Header="Ids"           Binding="{Binding Ids}"          Visibility="Collapsed"/>
        </DataGrid.Columns>
            </DataGrid>

        <!-- 3) Грид: панель кнопок -->
        <Grid Grid.Row="2" Margin="0,0,0,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0" Content="AddItem"     Command="{Binding AddItemCommand}"     Margin="2"/>
            <Button Grid.Column="1" Content="DeleteItem"  Command="{Binding DeleteItemCommand}"  Margin="2"/>
            <Button Grid.Column="2" Content="TransferOut" Command="{Binding TransferOutCommand}" Margin="2"/>
            <Button Grid.Column="3" Content="LomOut"      Command="{Binding LomOutCommand}"      Margin="2"/>
            <Button Grid.Column="4" Content="LomIn"       Command="{Binding LomInCommand}"       Margin="2"/>
            <Button Grid.Column="5" Content="Return"      Command="{Binding ReturnCommand}"      Margin="2"/>
            <Button Grid.Column="6" Content="{Binding TransferInButtonText}"  Command="{Binding TransferInCommand}"  Margin="2"/>
            <Button Grid.Column="7" Content="InCart"      Command="{Binding InCartCommand}"      Margin="2"/>
            <Button Grid.Column="8" Content="{Binding CartButtonText}"        Command="{Binding CartCommand}"        Margin="2"/>
        </Grid>

        <!-- Нижняя панель итогов -->
        <Grid Grid.Row="3" Margin="0,8,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="120"/>
                <ColumnDefinition Width="16"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="100"/>
                <ColumnDefinition Width="16"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="120"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0" Text="Итого вес: " VerticalAlignment="Center"/>
            <TextBlock Grid.Column="1" Text="{Binding TotalWeight, StringFormat=N3}" VerticalAlignment="Center"/>

            <TextBlock Grid.Column="3" Text="Итого шт: " VerticalAlignment="Center"/>
            <TextBlock Grid.Column="4" Text="{Binding TotalCount}" VerticalAlignment="Center"/>

            <TextBlock Grid.Column="6" Text="Итого сумма: " VerticalAlignment="Center"/>
            <TextBlock Grid.Column="7" Text="{Binding TotalPrice, StringFormat=N2}" VerticalAlignment="Center"/>
        </Grid>
    </Grid>
</UserControl>
